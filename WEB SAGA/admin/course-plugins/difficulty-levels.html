<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Difficulty Levels Management - WEBSAGA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../admin-style.css">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid px-4">
            <button class="btn btn-link me-3 fs-4" id="sidebarToggle">
                <i class="bi bi-list"></i>
            </button>
            <a class="navbar-brand" href="../Adashboard.html">
                <i class="bi bi-mortarboard-fill me-2"></i>WEBSAGA Admin
            </a>
            <div class="ms-auto">
                <span class="text-muted me-4 small">January 03, 2026</span>
                <a href="../../main.html" class="text-danger text-decoration-none" onclick="return confirm('Logout?')">
                    Logout <i class="bi bi-box-arrow-right"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h4 class="sidebar-text">ADMIN PANEL</h4>
        </div>
        <ul class="sidebar-menu mt-3">
            <li class="section-title sidebar-text">OVERVIEW</li>
            <li><a href="../Adashboard.html"><i class="bi bi-speedometer2"></i><span class="sidebar-text">
                        Dashboard</span></a></li>

            <li class="section-title sidebar-text mt-4">MASTER DATA</li>
            <li><a href="../programs.html"><i class="bi bi-diagram-3"></i><span class="sidebar-text">
                        Programs</span></a></li>
            <li><a href="../branches.html"><i class="bi bi-building"></i><span class="sidebar-text">
                        Departments</span></a></li>
            <li><a href="../regulations.html"><i class="bi bi-file-text"></i><span class="sidebar-text">
                        Regulations</span></a></li>

            <li class="section-title sidebar-text mt-4">ACADEMICS</li>
            <li><a href="../courses.html"><i class="bi bi-book"></i><span class="sidebar-text"> Courses</span></a></li>
            <li><a href="index.html" class="active"><i class="bi bi-puzzle"></i><span class="sidebar-text"> Course
                        Plugins</span></a></li>
            <li><a href="../program-branch-mapping.html"><i class="bi bi-diagram-3"></i><span class="sidebar-text">
                        Program-Branch Mapping</span></a></li>
            <li><a href="../branch-course-mapping.html"><i class="bi bi-link-45deg"></i><span class="sidebar-text">
                        Branch-Course Mapping</span></a></li>

            <li class="section-title sidebar-text mt-4">FACULTY</li>
            <li><a href="../faculty.html"><i class="bi bi-people"></i><span class="sidebar-text"> Faculty</span></a>
            </li>
            <li><a href="../faculty-course-mapping.html"><i class="bi bi-link-45deg"></i><span class="sidebar-text">
                        Faculty-Course Mapping</span></a></li>

            <li class="section-title sidebar-text mt-4">QUESTION PAPER</li>
            <li><a href="../question-paper-generation.html"><i class="bi bi-file-earmark-text"></i><span
                        class="sidebar-text"> Generate QP</span></a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid py-4">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="../Adashboard.html">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="index.html">Course Plugins</a></li>
                    <li class="breadcrumb-item active">Difficulty Levels</li>
                </ol>
            </nav>

            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3><i class="bi bi-bar-chart-steps text-success"></i> Difficulty Levels</h3>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">
                    <i class="bi bi-plus-circle"></i> Add Level
                </button>
            </div>

            <div class="card mb-4">
                <div class="card-body">
                    <input type="text" class="form-control" placeholder="Search difficulty levels..."
                        onkeyup="filterTable(this)">
                </div>
            </div>

            <div class="card">
                <div class="card-body table-responsive">
                    <table class="table table-hover" id="difficultyTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Level Name</th>
                                <th>Description</th>
                                <th>Order</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Modal -->
    <div class="modal fade" id="addModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <form onsubmit="addLevel(event)">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Difficulty Level</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Level Name</label>
                            <input type="text" class="form-control" id="levelName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="levelDesc" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Order</label>
                            <input type="number" class="form-control" id="levelOrder" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="levelStatus" required>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Level</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <form onsubmit="updateLevel(event)">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Difficulty Level</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="editId">
                        <div class="mb-3">
                            <label class="form-label">Level Name</label>
                            <input type="text" class="form-control" id="editName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="editDesc" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Order</label>
                            <input type="number" class="form-control" id="editOrder" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="editStatus" required>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Level</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const KEY = 'wsg_difficulty';

        // Sidebar Toggle
        document.getElementById('sidebarToggle').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('collapsed');
        });

        function logout() {
            Auth.logout();
        }

        document.addEventListener('DOMContentLoaded', () => {
            Auth.requireAuth(['admin']);
            loadData();
        });

        function loadData() {
            const existing = DB.getAll(KEY);
            if (existing.length === 0) {
                const seeds = [
                    { name: 'Easy', desc: 'Basic questions requiring fundamental knowledge', order: 1, status: 'Active' },
                    { name: 'Medium', desc: 'Moderate questions requiring application of concepts', order: 2, status: 'Active' },
                    { name: 'Hard', desc: 'Complex questions requiring advanced analysis', order: 3, status: 'Active' }
                ];
                seeds.forEach(s => DB.add(KEY, s));
            }
            renderTable();
        }

        function renderTable() {
            const difficultyLevels = DB.getAll(KEY);
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            difficultyLevels.forEach(l => {
                let badgeClass = l.status === 'Active' ? 'bg-success' : 'bg-secondary';
                tbody.innerHTML += `
                <tr>
                    <td>${l.id}</td>
                    <td>${l.name}</td>
                    <td>${l.desc}</td>
                    <td>${l.order}</td>
                    <td><span class="badge ${badgeClass}">${l.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="editLevel('${l.id}')"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger me-1" onclick="deleteLevel('${l.id}')"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>`
            });
        }

        function addLevel(e) {
            e.preventDefault();

            const name = document.getElementById('levelName').value.trim();
            const desc = document.getElementById('levelDesc').value.trim();
            const order = document.getElementById('levelOrder').value;
            const status = document.getElementById('levelStatus').value;

            const difficultyLevels = DB.getAll(KEY);
            // Check for duplicate level name (case-insensitive)
            const duplicate = difficultyLevels.find(l => l.name.toLowerCase() === name.toLowerCase());

            if (duplicate) {
                alert("A difficulty level with the same name already exists. Please use a different name.");
                return;
            }

            DB.add(KEY, { name, desc, order, status });
            bootstrap.Modal.getInstance(document.getElementById('addModal')).hide();
            e.target.reset();
            renderTable();
        }

        function editLevel(id) {
            const lvl = DB.getById(KEY, id);
            if (!lvl) return;
            document.getElementById('editId').value = lvl.id;
            document.getElementById('editName').value = lvl.name;
            document.getElementById('editDesc').value = lvl.desc;
            document.getElementById('editOrder').value = lvl.order;
            document.getElementById('editStatus').value = lvl.status;
            new bootstrap.Modal(document.getElementById('editModal')).show();
        }

        function updateLevel(e) {
            e.preventDefault();

            const id = document.getElementById('editId').value;
            const name = document.getElementById('editName').value.trim();
            const desc = document.getElementById('editDesc').value.trim();
            const order = document.getElementById('editOrder').value;
            const status = document.getElementById('editStatus').value;

            const difficultyLevels = DB.getAll(KEY);
            // Check for duplicate level name (case-insensitive), unless editing the same record
            const duplicate = difficultyLevels.find(l =>
                l.name.toLowerCase() === name.toLowerCase() && l.id != id
            );

            if (duplicate) {
                alert("A difficulty level with the same name already exists. Please use a different name.");
                return;
            }

            DB.update(KEY, id, { name, desc, order, status });
            bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
            renderTable();
        }

        function deleteLevel(id) {
            if (confirm('Delete this level?')) {
                DB.delete(KEY, id);
                renderTable();
            }
        }

        function filterTable(input) {
            const val = input.value.toLowerCase();
            document.querySelectorAll('#difficultyTable tbody tr').forEach(r => {
                r.style.display = r.innerText.toLowerCase().includes(val) ? '' : 'none';
            });
        }
    </script>

    <!-- Core Modules -->
    <script src="../../js/db.js"></script>
    <script src="../../js/auth.js"></script>


</body>

</html>